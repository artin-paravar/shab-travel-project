!function(){let data="",DzhTrcId=9276484871,session_id,visibleInterval,AlreadySent30,clAlreadySent,dlAlreadySent,atAlreadySent,pCount,aTriggerLoaded,current_ts,sessStart,sessDur,firstLanding,timerListenerLoaded,stopSend=0,yPoseOldMouse=0,xPoseOldMouse=0,yPoseOldScroll=0,xPoseOldScroll=0,ub1=0,ub2=0,tOnP=0,scriptLoaded=0,actionCount=15,availableActions=["pCount"];for(i=1;i<=actionCount;i++)eval("var actionId"+i+";"),availableActions.push("actionId"+i);let tOnPageValue=60,scPercentValue=50;function getCurrentTs(){return Math.floor(Date.now()/1e3)}current_ts=getCurrentTs();let pageLoadTimeStamp=Date.now();function actionIdCounter(e){let t=parseInt(localStorage.getItem("actionId"+e));return localStorage.setItem("actionId"+e,t+1),t+1}function isValidOrigin(){return"https://www.shab.ir"===window.origin}function loadScript(e=0){if(scriptLoaded=1,""==document.referrer||new URL(document.referrer).origin!=new URL(window.location.origin).origin?(firstLanding=1,localStorage.setItem("firstLandingUrl",currentUrl)):firstLanding=0,null!=localStorage.getItem("sessionStart")?sessStart=localStorage.getItem("sessionStart"):console.log("CSS!"),!parseInt(localStorage.getItem("dlAlreadySent"))){let e=new FormData;e=appendInitData(e),sendData(e,"dl"),localStorage.setItem("dlAlreadySent",1)}console.log(window.origin+" is protected! - "+e),pageCounter(),1!=aTriggerLoaded&&aTriggerListener(),1!=timerListenerLoaded&&timerListener()}function makeData(e,t){let n=e+"&"+t;if(n.length>200&&!ub2){let e=new FormData;e=appendInitData(e),e.append("data",n),sendData(e,"ub2"),ub2=1}return n}function timeConverter(e){var t=new Date(1e3*e),n=t.getFullYear(),o=t.getMonth();return t.getDate()+"/"+o+"/"+n+"-"+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}let sendData=function(e,t){sessDur=getCurrentTs()-localStorage.getItem("sessionStart"),e.append("session_duration","undefined"!=sessDur?sessDur:0),e.append("chunk",t),e.append("chunk_ts",Math.floor(Date.now()-pageLoadTimeStamp)),e.append("origin",window.origin),e.append("referrer",previousUrl),"np"!=t&&e.append("page_count",localStorage.getItem("pCount"));let n=new URL(localStorage.getItem("firstLandingUrl")),o=new XMLHttpRequest;if(e.append("url",n),isValidOrigin()){if("cl"===t&&1===clAlreadySent||"30"===t&&1===AlreadySent30||"ub2"===t&&1===ub2||"dl"===t&&1===dlAlreadySent)return 0;stopSend||o&&(currentUrl.includes("utm_")||n.search.includes("utm_"))&&(o.open("POST","https://ingest.dezhino.com/api/v2/"+DzhTrcId),o.send(e))}};function today(e){return timeConverter(e/1e3).split("-")[0]}function getBaseUrl(e){return null==e||""==e?null:e.match(/:\/\/(.[^/]+)/)[1]}function appendInitData(e){return e.append("device_type",deviceType),e.append("web_driver",webdriver),e.append("web_driver2",webdriver2),e.append("history",historyLength),e.append("load_time",pageLoadTimeStamp),e.append("size",size),e.append("languages",userBrowserLanguages),e.append("url_params",urlParamsResult),e.append("user_agent",userAgent),e.append("screen",devSc),e.append("cookie_enabled",navigator.cookieEnabled),e.append("uid",uid),e.append("uid_cookie",uidCookie),e.append("no_session_id",localStorage.getItem("session-id")?"0":"1"),e.append("session_id",session_id),e.append("session_page_count",sessionStorage.pageviewcount),e.append("session_click_count",sessionStorage.clickcount),e}function currentTimeToLocalString(){return Date.now()+60*Date().toLocaleString().split(" ")[5].split("+")[1].match(/.{1,2}/g)[0]*60*1e3+60*Date().toLocaleString().split(" ")[5].split("+")[1].match(/.{1,2}/g)[1]*1e3}function normalize_number_100(e){return(e=(e=e>=100?99:e)<=0?1:e)%10>0?10*Math.floor(e/10):10*Math.floor((e-1)/10)}if(""!=document.referrer)var new_referrer=document.referrer;else var new_referrer=null;if(null===localStorage.getItem("session-id")||null===localStorage.getItem("expiry-ts")||current_ts>parseInt(localStorage.getItem("expiry-ts"),10)||today(Date.now())!==localStorage.getItem("today")||getBaseUrl(window.origin)!==getBaseUrl(document.referrer)||sessionStorage.trafficSource!==getBaseUrl(new_referrer)&&getBaseUrl(new_referrer)!==getBaseUrl(window.origin)){for(console.log("NSC!"),session_id=[Math.floor(88888889*Math.random())+11111111,Date.now()].join(""),localStorage.setItem("session-id",session_id),localStorage.setItem("today",today(Date.now())),sessionStorage.clickcount=0,sessionStorage.pageviewcount=0,spCount=0,i=1;i<=actionCount;i++)eval("actionId"+i+" = 0;");for(a of availableActions)localStorage.setItem(a,0);localStorage.setItem("dlAlreadySent",0),sessStart=current_ts,localStorage.setItem("sessionStart",current_ts),localStorage.setItem("firstLandingUrl",window.location.href),""!==document.referrer?sessionStorage.trafficSource=new_referrer:sessionStorage.trafficSource=null}else for(console.log("SPS!"),session_id=localStorage.getItem("session-id"),pCount=localStorage.getItem("pCount")??0,i=1;i<=actionCount;i++)eval("actionId"+i+" = localStorage.getItem('actionId"+i+"') ?? 0;");localStorage.setItem("expiry-ts",current_ts+1800),sessionStorage.pageviewcount?sessionStorage.pageviewcount=Number(sessionStorage.pageviewcount)+1:sessionStorage.pageviewcount=1;const getDeviceType=()=>{const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"};var deviceType=getDeviceType(),webdriver=window.document.documentElement.getAttribute("webdriver"),webdriver2=navigator.webdriver;let docHeight=0,docWidth=0,windowInnerHeight=0,windowInnerWidth=0,size=0;function ready(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e,1):document.addEventListener("DOMContentLoaded",e)}ready((function(){docHeight=void 0!==document.height?document.height:document.body.offsetHeight,docWidth=void 0!==document.width?document.width:document.body.offsetWidth,windowInnerHeight=window.innerHeight,windowInnerWidth=window.innerWidth,size=docHeight+","+docWidth+","+windowInnerHeight+","+windowInnerWidth,!scriptLoaded&&loadScript(1)}));var previousUrl=document.referrer,currentUrl=window.location.href,userAgent=navigator.userAgent,urlParams={};(window.onpopstate=function(){for(var e,t=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(t," "))},a=window.location.search.substring(1);e=n.exec(a);)urlParams[o(e[1])]=o(e[2])})();var urlParamsResult=[];for(var i in urlParams)urlParamsResult.push([i]);var userBrowserLanguages=window.navigator.languages,userScreenWidthInPixel=window.screen.width,userScreenHeightInPixel=window.screen.height,devSc=userScreenHeightInPixel+","+userScreenWidthInPixel;function makeUID(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<e;o++)t+=n.charAt(Math.floor(62*Math.random()));return t}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}var uidCookie=getCookie("DETECTOR_UID"),uid=void 0;if(null==uidCookie){var expireDate=new Date(Date.now()+31536e6);uid=makeUID(4)+"-"+makeUID(4)+"-"+makeUID(4)+"-"+makeUID(4),document.cookie="DETECTOR_UID="+uid+"; path=/; expires="+expireDate.toUTCString(),uidCookie=getCookie("DETECTOR_UID")}document.addEventListener("load",(function(){!scriptLoaded&&loadScript(3),1!=aTriggerLoaded&&aTriggerListener()}));const loadEvents=["pagehide","pageshow","unload","load"],eventLogger=e=>{switch(e.type){case"pagehide":case"pageshow":e.persisted;break;case"load":!scriptLoaded&&loadScript(2),1!=aTriggerLoaded&&aTriggerListener();break;case"unload":let t=Date.now(),n=new FormData;n=appendInitData(n),n.append("exit_time",t),n.append("session_id",session_id),n.append("data",data),n.append("time_on_page",getCurrentTs()-current_ts),sendData(n,"end-"+localStorage.getItem("pCount")),stopSend=1}};loadEvents.forEach((e=>window.addEventListener(e,eventLogger)));var historyLength=window.history.length.toString();events=["click","mousemove","scroll","wheel"];var oldScroll=0;events.forEach((function(e){document.addEventListener(e,(function(t){if(firstLanding){var n=document.getElementsByTagName("body")[0].offsetHeight,o=document.getElementsByTagName("body")[0].offsetWidth,a=Date.now()-pageLoadTimeStamp;if("wheel"===e){var i=t.deltaY>0?"wd":"wu";data=makeData(data,i+"-"+a)}if("scroll"===e){var r="sc";let e=Math.round(window.scrollY),t=Math.round(window.scrollX),i=oldScroll>e?"up":"dn";oldScroll=e;let l=e/(n-windowInnerHeight);isValidOrigin()&&100*l>=scPercentValue&&(parseInt(localStorage.getItem("scPercent"))||(actionId=2,triggerKeyUpdate("actionId"+actionId,1,!1,actionId)));let c=t/(o-windowInnerWidth),u=Math.round(100*l),g=Math.round(100*c);var d=normalize_number_100(u),s=g?normalize_number_100(g):0;d===yPoseOldScroll&&s===xPoseOldScroll||(yPoseOldScroll=d,xPoseOldScroll=s,data=makeData(data,i+"-"+a+"-Y"+yPoseOldScroll+"-X"+xPoseOldScroll+"-"+window.pageYOffset.toFixed(2)+" - "+window.pageXOffset.toFixed(2)))}if("mousemove"===e){r="mm";var l=Math.round(100*t.pageX/document.body.clientWidth);d=normalize_number_100(Math.round(100*t.pageY/document.body.clientHeight)),s=normalize_number_100(l);d===yPoseOldMouse&&s===xPoseOldMouse||(yPoseOldMouse=d,xPoseOldMouse=s,data=makeData(data,r+"-"+a+"-X"+xPoseOldMouse+"-Y"+yPoseOldMouse))}if("click"===e){r="cl";sessionStorage.clickcount?sessionStorage.clickcount=Number(sessionStorage.clickcount)+1:sessionStorage.clickcount=1;let e=t.srcElement.clientWidth,i=t.srcElement.clientHeight;var c=document.body.getBoundingClientRect(),u=t.srcElement.getBoundingClientRect(),g=u.top-c.top,p=u.left-c.left;let d=normalize_number_100(Math.round(100*g/document.body.clientHeight)),s=normalize_number_100(Math.round(100*p/document.body.clientWidth));var m=t.srcElement.id?t.srcElement.id:null;switch(t.srcElement.tagName){case"Button":var f="btn-"+m+"-"+t.srcElement.innerHTML;break;case"A":f="a-"+m+"-"+t.srcElement.getAttribute("href");break;default:f="other-"+m+"-"+JSON.stringify(Object.values(t.srcElement.classList))}data=makeData(data,r+"-"+a+"-X"+Math.floor(t.pageX)+"-Y"+Math.floor(t.pageY)+"-"+f+"-top"+d+"-left"+s+"-height"+i+"-width"+e+"-dheight"+n+"-dwidth"+o);let l=new FormData;l=appendInitData(l),l.append("session_id",session_id),l.append("data",data),sendData(l,"cl"),clAlreadySent=1}}}))})),document.addEventListener("visibilitychange",(function(){var e=Date.now()-pageLoadTimeStamp;data=(document.hidden,makeData(data,document.visibilityState+"-"+e))}));let timerListener=function(){visibleInterval=setInterval((function(){if("visible"===document.visibilityState){sec=sessDur=getCurrentTs()-sessStart;getCurrentTs();if(5==sec||sec<=60&&!(sec%10>0)||sec>60&&sec<=240&&!(sec%15>0)||sec>240&&!(sec%30>0)){let e="sd",t=new FormData;30==sec&&(t=appendInitData(t),e=sec),[5,10,20].includes(sec)&&(t=appendInitData(t),firstLanding&&t.append("data",data),e=sec),sec===tOnPageValue&&isValidOrigin()&&(actionId=1,triggerKeyUpdate("actionId"+actionId,1,!1,actionId)),t.append("page_count",localStorage.getItem("pCount")),t.append("session_id",session_id),sendData(t,e)}}}),1e3),timerListenerLoaded=1},pageCounter=function(){if(localStorage.setItem("pCount",parseInt(localStorage.getItem("pCount"))+1),parseInt(localStorage.getItem("dlAlreadySent"))||localStorage.getItem("pCount")>=2){let e=new FormData;e.append("session_id",session_id),e.append("page_count",localStorage.getItem("pCount")),sendData(e,"np")}},triggerKeyUpdate=function(e,t=null,n=!1,o=0){if(n||!n&&!parseInt(localStorage.getItem(e))){localStorage.setItem(e,t||1);let n=new FormData;n.append("session_id",session_id),n.append("trigger",e),n.append("trigger_value",t||1),n.append("at_id",o),n.append("at_data",currentUrl),sendData(n,"at")}},aTriggerListener=function(){if(aTriggerLoaded=1,isValidOrigin()&&(target=Array.from(document.querySelectorAll("a")),target.length>0))for(t of target)t.addEventListener("mousedown",(function(){actionId=3,triggerKeyUpdate("actionId"+actionId,actionIdCounter(actionId),!0,actionId),atAlreadySent=1}));if(isValidOrigin()&&window.location.pathname.includes("search/city")&&(actionId=4,triggerKeyUpdate("actionId"+actionId,actionIdCounter(actionId),!0,actionId),atAlreadySent=1),isValidOrigin()&&window.location.pathname.includes("houses/show")&&(actionId=5,triggerKeyUpdate("actionId"+actionId,actionIdCounter(actionId),!0,actionId),atAlreadySent=1),isValidOrigin()&&/.*sandbox\/.*\/verify/.test(window.location.pathname)&&(actionId=6,triggerKeyUpdate("actionId"+actionId,actionIdCounter(actionId),!0,actionId),atAlreadySent=1),isValidOrigin()&&"/"==location.pathname){const e=Array.from(document.querySelectorAll("ul > li > div > div > a")).filter((e=>e.href.includes("houses/show")));if(e.length>0)for(const t of e)t.addEventListener("mousedown",(function(){triggerKeyUpdate("actionId7",actionIdCounter(7),!0,7),atAlreadySent=1}))}if(isValidOrigin()&&location.pathname.includes("search/city")){const e=Array.from(document.querySelectorAll("ul > li > div > a")).filter((e=>e.href.includes("houses/show")));if(e.length>0)for(const t of e)t.addEventListener("mousedown",(function(){triggerKeyUpdate("actionId8",actionIdCounter(8),!0,8),atAlreadySent=1}))}if(isValidOrigin()&&location.pathname.includes("houses/show")){const e=Array.from(document.querySelectorAll("button")).filter((e=>e.innerText.includes("انتخاب تاریخ سفر")));if(e.length>0)for(const t of e)t.addEventListener("mousedown",(function(){triggerKeyUpdate("actionId9",actionIdCounter(9),!0,9),atAlreadySent=1}))}if(isValidOrigin()&&location.pathname.includes("houses/show")){const e=Array.from(document.querySelectorAll("button")).filter((e=>e.innerText.includes("ارسال درخواست رزرو رایگان")));if(e.length>0)for(const t of e)t.addEventListener("mousedown",(function(){triggerKeyUpdate("actionId10",actionIdCounter(10),!0,10),atAlreadySent=1}))}if(isValidOrigin()&&location.pathname.includes("houses/show")){const e=Array.from(document.querySelectorAll("button")).filter((e=>e.innerText.includes("پرداخت")));if(e.length>0)for(const t of e)t.addEventListener("mousedown",(function(){triggerKeyUpdate("actionId10",actionIdCounter(10),!0,10),atAlreadySent=1}))}}}();
